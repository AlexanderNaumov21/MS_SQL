use Фитнес_клуб
go
/*
-- вывод клиентов от фирм + названия и контактные телефоны фирм
select Имя, Фамилия, Название_фирмы, Номер_телефона from Клиент, Корпоротивный_клиент
where  Клиент.ID_Корпоротивный_клиент is not null and
 Клиент.ID_Корпоротивный_клиент = Корпоротивный_клиент.ID_Корпоротивный_клиент
 
-- Какиe Клиенты с групповыми абониментами  зачислены в группы
select Имя, Фамилия, Название, Дисциплина, Группа.ID_Группа from Клиент, Абонимент, Абонименты_групп, Группа
where Клиент.ID_Клиент = Абонимент.ID_Клиент and
	Абонимент.ID_Абонимент = Абонименты_групп.ID_Абонимент and
	Абонименты_групп.ID_Группа = Группа.ID_Группа

-- Какие групповые абонименты есть у клиентов
select Клиент.Имя, Клиент.Фамилия, Вид_абонимента.Название from  Абонимент
	full outer join Клиент on Абонимент.ID_Клиент = Клиент.ID_Клиент
	full outer join Вид_абонимента on Вид_абонимента.ID_Вид_абонимента = Абонимент.ID_Вид_абонимента
	left outer join Абонименты_групп on Абонимент.ID_Абонимент = Абонименты_групп.ID_Абонимент
where Абонимент.ID_Вид_абонимента  in (10, 11,12, 16, 20, 21)	

-- сортировка по дате получения абонимента ( по убыванию)
select Клиент.Имя, Клиент.Фамилия, Вид_абонимента.Название, Абонимент.Дата_получения from  Абонимент
	inner join Клиент on Абонимент.ID_Клиент = Клиент.ID_Клиент
	inner join Вид_абонимента on Вид_абонимента.ID_Вид_абонимента = Абонимент.ID_Вид_абонимента
	order by Абонимент.Дата_получения desc

-- Виды абониментов отсортированные по цене на увеличение
select Название, Цена , Конец_срока as Длительность, Время_начала as [Время начала], Время_конца as [Время конца] from  Вид_абонимента
	order by Цена asc
 
-- Какую цену заплатили корпоративные клиенты за все время в 2022 году
select Корпоротивный_клиент.Название_фирмы,  sum(Вид_абонимента.Цена) as [Сумма за все время] from Абонимент
	inner join Клиент on Абонимент.ID_Клиент = Клиент.ID_Клиент 
	inner join Корпоротивный_клиент on Клиент.ID_Корпоротивный_клиент = Корпоротивный_клиент.ID_Корпоротивный_клиент
	inner join Вид_абонимента on Абонимент.ID_Вид_абонимента = Вид_абонимента.ID_Вид_абонимента
	where Абонимент.Дата_получения > '2022-01-01' 
	group by Корпоротивный_клиент.Название_фирмы


--Отсортированный список с суммами цен индивидуальных занятий тренеров
select Тренер.ID_Тренер, Сотрудник.Имя, Сотрудник.Фамилия , sum(Индивидуальная_тренеровка.Цена) as [Сумма за все время] from Тренер
	inner join Индивидуальная_тренеровка on Тренер.ID_Тренер = Индивидуальная_тренеровка.ID_Тренер
	inner join Сотрудник on Тренер.ID_Сотрудник = Сотрудник.ID_Сотрудник
	group by Сотрудник.Имя, Сотрудник.Фамилия,  Тренер.ID_Тренер
	order by Сотрудник.Имя, Сотрудник.Фамилия
*/

-- количество клиентов в фитнес клубе и сколько они имеют абониментов
select Клиент.ID_Клиент, count(Абонимент.ID_Клиент) as [Количество абониментов] from Клиент
	full join Абонимент on Клиент.ID_Клиент = Абонимент.ID_Клиент
	group by Абонимент.ID_Клиент, Клиент.ID_Клиент





/*
-- Поиск ID клиента по имени и фамилии
select Клиент.ID_Клиент, Клиент.Имя, Клиент.Фамилия, Клиент.Телефон from Клиент
where Имя = 'Имя21' and Фамилия = 'Фамилия21'
--Изменение Номера телефона

update Клиент set Телефон ='89601889925'
 where ID_Клиент = 30 

--Удалить последнюю строку из таблицы
delete from Индивидуальная_тренеровка where ID_Индивидуальная_тренировка=(select max(ID_Индивидуальная_тренеровка) from Индивидуальная_тренеровка)
*/